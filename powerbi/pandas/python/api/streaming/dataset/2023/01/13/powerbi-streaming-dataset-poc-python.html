<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Streaming Data From A File To Power BI Streaming Dataset Using Python</h1><p class="page-description">Create streaming dataset based on an existing file using Python. Super handy for POCs.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2023-01-13T00:00:00-06:00" itemprop="datePublished">
        Jan 13, 2023
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      3 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#powerbi">powerbi</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#pandas">pandas</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#python">python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#api">api</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#streaming">streaming</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#dataset">dataset</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/pawarbi/blog/tree/master/_notebooks/2023-01-13-powerbi-streaming-dataset-poc-python.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/pawarbi/blog/master?filepath=_notebooks%2F2023-01-13-powerbi-streaming-dataset-poc-python.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/pawarbi/blog/blob/master/_notebooks/2023-01-13-powerbi-streaming-dataset-poc-python.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#Streaming-Dataset">Streaming Dataset </a>
<ul>
<li class="toc-entry toc-h5"><a href="#Create-A-Streaming-dataset">Create A Streaming dataset </a></li>
<li class="toc-entry toc-h3"><a href="#Python-Script">Python Script </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Import-libraries">Import libraries </a>
<ul>
<li class="toc-entry toc-h5"><a href="#Data">Data </a></li>
<li class="toc-entry toc-h5"><a href="#Test">Test </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2023-01-13-powerbi-streaming-dataset-poc-python.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Streaming-Dataset">
<a class="anchor" href="#Streaming-Dataset" aria-hidden="true"><span class="octicon octicon-link"></span></a>Streaming Dataset<a class="anchor-link" href="#Streaming-Dataset"> </a>
</h2>
<p>It's easy to create a streaming dataset in Power BI for real-time applications. You do not need a premium capacity. To keep the blog short, I am going to assume you already know what is a streaming dataset and how it differs from import/DQ. If you are not familiar, <a href="https://learn.microsoft.com/en-us/power-bi/connect-data/service-real-time-streaming">this documentation</a> will help.</p>
<p>Imagine you are creating a POC and would like to develop the real-time dashboard, report or just want to show to your stakeholders what the solution would loook like, you will need data to stream to Power BI service. You can create Azure Event Hub, Streaming Analytics. But in this blog, I will show you how you can stream data from an existing file. I will also include a link below in the resources for a few sample datasets you can use depending on the use case.</p>
<p>You will need a Python IDE with pandas installed.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Create-A-Streaming-dataset">
<a class="anchor" href="#Create-A-Streaming-dataset" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create A Streaming dataset<a class="anchor-link" href="#Create-A-Streaming-dataset"> </a>
</h5>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First create a streaming dataset in Power BI service using the API method.
<img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/KP9NMM8b4g.png" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I will be using this dataset for my example. Note the columns and column types from your data and create the dataset. 
<img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/msedge_dyzzbjo5kF.png" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note the API endpoint:
<img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/msedge_imlnDaqdcW.png" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Python-Script">
<a class="anchor" href="#Python-Script" aria-hidden="true"><span class="octicon octicon-link"></span></a>Python Script<a class="anchor-link" href="#Python-Script"> </a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Import-libraries">
<a class="anchor" href="#Import-libraries" aria-hidden="true"><span class="octicon octicon-link"></span></a>Import libraries<a class="anchor-link" href="#Import-libraries"> </a>
</h2>
<p>import requests
from datetime import datetime
from dataclasses import dataclass
import numpy as np
from typing import List, Dict
from time import sleep
import pandas as pd</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@dataclass</span>


<span class="k">class</span> <span class="nc">StreamToPowerBI</span><span class="p">:</span>
    
    <span class="sd">"""</span>

<span class="sd">    Class to stream data to Power BI Streaming dataset</span>
<span class="sd">    --------------------------------------------------</span>
<span class="sd">    Example:</span>

<span class="sd">     - endpoint :  API ednpoint, e.g. "https://api.powerbi.com/beta/&lt;ws_id&gt;/datasets/&lt;dataset_id&gt;/rows?key=&lt;___key___&gt;"</span>
<span class="sd">     - data     :  Data in dictionary e.g. {"id":1, "Value":2.33, "Color":"Red"} </span>
<span class="sd">                   Number of columns, column names and column type must match with Power BI.</span>
<span class="sd">     - delay    :  Delay in seconds in sending the data to Power BI. e.g. if delay is 3, data will be sent every 3 seconds.</span>
<span class="sd">                   default value is 2 seconds. To overwrite, use the wait() method</span>
<span class="sd">                   </span>
<span class="sd">                   </span>
<span class="sd">     example:      To stream data to the specified endpoint with 5 s delay</span>
<span class="sd">                   StreamToPowerBI(endpoint,data).wait(5).post_data()              </span>
<span class="sd"> </span>
<span class="sd">    """</span>
    <span class="n">endpoint</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span>
    <span class="n">delay</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">2</span>   
        
    <span class="k">def</span> <span class="nf">wait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">''' Delay in seconds to stream the data '''</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
            <span class="c1"># default value is 2 seconds</span>
            <span class="n">other</span> <span class="o">=</span> <span class="mi">2</span> 
        <span class="n">sleep</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>    
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">post_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">''' Use post method send the data to Power BI'''</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">endpoint</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">]</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">json</span> <span class="o">=</span> <span class="n">payload</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">status_code</span><span class="o">==</span><span class="mi">200</span><span class="p">:</span>
                <span class="n">x</span><span class="o">=</span><span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">"Failed ! Check endpoint, data"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Data passed is not a dictionary. It should be in the format </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">'</span><span class="si">{}</span><span class="s1">'</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">x</span>
    
    
    
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Data">
<a class="anchor" href="#Data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data<a class="anchor-link" href="#Data"> </a>
</h5>
<p>Import the data using pandas or any other library (spark, polars etc.). Be sure to make the numeric columns type <code>float</code> otherwise json serialization will fail. I am also removing null values.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/reisanar/datasets/master/eBayAuctions.csv"</span><span class="p">,</span> 
                  <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                  <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">'Category'</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
                         <span class="s1">'currency'</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
                         <span class="s1">'sellerRating'</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span>
                         <span class="s1">'Duration'</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span>
                         <span class="s1">'ClosePrice'</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span>
                         <span class="s1">'OpenPrice'</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span>
                         <span class="s1">'Competitive?'</span><span class="p">:</span><span class="nb">float</span><span class="p">},</span>
                  <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">'Category'</span><span class="p">,</span><span class="s1">'currency'</span><span class="p">,</span><span class="s1">'sellerRating'</span><span class="p">,</span><span class="s1">'Duration'</span><span class="p">,</span><span class="s1">'ClosePrice'</span><span class="p">,</span><span class="s1">'OpenPrice'</span><span class="p">,</span><span class="s1">'Competitive?'</span><span class="p">])</span>
     <span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5 id="Test">
<a class="anchor" href="#Test" aria-hidden="true"><span class="octicon octicon-link"></span></a>Test<a class="anchor-link" href="#Test"> </a>
</h5>
<p>Before streaming data from the whole file, let's first test using one data point. Note that in the orginal data, there is no timestamp, so I am adding the timestamp , i.e <code>DateTime</code> column, to the dictionary. In your case, you may not want to do that. comment it out if you want to stream the data as is.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">d</span><span class="p">[</span><span class="s1">'DateTime'</span><span class="p">]</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
<span class="n">d</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="pawarbi/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/powerbi/pandas/python/api/streaming/dataset/2023/01/13/powerbi-streaming-dataset-poc-python.html" hidden></a>
</article>