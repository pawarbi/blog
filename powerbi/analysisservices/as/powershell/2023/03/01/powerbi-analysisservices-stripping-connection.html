<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Stripping Off Analysis Services Connection From Multiple Power BI Files</h1><p class="page-description">PowerShell script to strip off analysis services connection from multiple Power BI files at once</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2023-03-01T00:00:00-06:00" itemprop="datePublished">
        Mar 1, 2023
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      3 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#powerbi">powerbi</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#analysisservices">analysisservices</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#AS">AS</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#powershell">powershell</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/pawarbi/blog/tree/master/_notebooks/2023-03-01-powerbi-analysisservices-stripping-connection.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/pawarbi/blog/master?filepath=_notebooks%2F2023-03-01-powerbi-analysisservices-stripping-connection.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/pawarbi/blog/blob/master/_notebooks/2023-03-01-powerbi-analysisservices-stripping-connection.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#Stripping-Off-AS-Connection">Stripping Off AS Connection </a></li>
<li class="toc-entry toc-h2"><a href="#Steps">Steps </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Script">Script </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2023-03-01-powerbi-analysisservices-stripping-connection.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Stripping-Off-AS-Connection">
<a class="anchor" href="#Stripping-Off-AS-Connection" aria-hidden="true"><span class="octicon octicon-link"></span></a>Stripping Off AS Connection<a class="anchor-link" href="#Stripping-Off-AS-Connection"> </a>
</h2>
<p>I recently completed a project to migrate 45 Power BI reports from analysis services to Power BI Premium datasets. If you have a Power BI file (*.pbix) that's connected to AS instance, and if you don't have access to AS, opening the Power BI file give you an error message below.</p>
<p><img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/ASPBI1.png" alt=""></p>
<p>The solution to this is to use a <a href="https://powerbi.tips/2020/05/hot-swap-power-bi-report-connections/">PowerShell script</a> developed and shared by <a href="https://powerbi.tips/author/steve-campbell/">Steve Campbell</a>. This script works perfectly. But in my case, I had 45 reports so instead of manually applying the script to 45 reports, I just modified it a bit to strip off the connection, save the pbix and also copy the original pbix files to another folder for backup. <strong>Please note that Steve gets 100% credit for this script</strong>, I merely modified it to suit my purposes. Please <a href="https://powerbi.tips/2020/05/hot-swap-power-bi-report-connections/">refer to blog</a> for his instructions to use the original script.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Steps">
<a class="anchor" href="#Steps" aria-hidden="true"><span class="octicon octicon-link"></span></a>Steps<a class="anchor-link" href="#Steps"> </a>
</h2>
<ol>
<li>Save all the pbix files to a folder. Copy the folder path.</li>
</ol>
<p><img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/ASPBI2.png" alt=""></p>
<ol>
<li>Replace the folder path for <code>$dir</code> variable as shown below. Note that the folder path must end with \</li>
</ol>
<p><img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/ASPBI3.png" alt=""></p>
<ol>
<li>
<p>Run the PowerShell</p>
</li>
<li>
<p>That's it. If you now go back to the above folder, you will see another folder created called <code>original_pbix</code>. This folder has the original pbix files with AS connections. Files in the base folder should now be devoid of AS connection.</p>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/ASPBI4.png" alt=""></p>
<ol>
<li>Open the pbix and point to the Power BI dataset. As long as all the column, table, measure names etc are the same as the AS, you should be able to successfully map the report to the Power BI dataset. </li>
</ol>
<p><img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/ASPBI5.png" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Script">
<a class="anchor" href="#Script" aria-hidden="true"><span class="octicon octicon-link"></span></a>Script<a class="anchor-link" href="#Script"> </a>
</h3>
<pre><code>
##### Script to strip-off AS Connection and save the PBIX files 
##### Original script: https://powerbi.tips/2020/05/hot-swap-power-bi-report-connections/
##### Input from Bryan Campbell, Hitachi Solutions America
##### Modified the original by Sandeep Pawar to apply en-masse to many files
##### Ver 1.0 | Last Update: 10/26/2022

&lt;#
Instructions: 

1. Save the PBIX with Analysis Services connections to a folder
2. Change the $dir variable below to above folder path

#&gt; 


$dir = "C:\Users\&lt;path&gt;\AS PBI Files\" #Be sure to have a \ at the end

"Checking if $dir  exists"
if (Test-Path -Path $dir) {

    #Copy files to a new folder for backup
    New-Item -Path $dir'original_pbix' -ItemType Directory
    Copy-Item -Path $dir'*.pbix' -Destination $dir'original_pbix'


    $pbi_files = Get-ChildItem -Path $dir -Filter *.pbix


    # Loop over each file, strip off and save the file as a zip file

    foreach ($file in $pbi_files) {

    $pathn =  $dir+$file.Name 

        Write-Output "Extracting " $file
        #Error check function
        function IsFileLocked([string]$filePath){
            Rename-Item $filePath $filePath -ErrorVariable errs -ErrorAction SilentlyContinue
            return ($errs.Count -ne 0)
        }


        #Choose file
        try {$pathn}
        catch { "Incompatible File" }


        #Check for errors
        If([string]::IsNullOrEmpty($pathn )){            
            exit } 

        elseif ( IsFileLocked($pathn) ){
            exit } 

        #Run Script
        else{    

            #Unzip pbix
            [Reflection.Assembly]::LoadWithPartialName('System.IO.Compression')
            $zipfile = $pathn.Substring(0,$pathn.Length-4) + "zip"
            Rename-Item -Path $pathn -NewName  $zipfile

            #Delete files
            $files   = 'Connections', 'SecurityBindings'
            $stream = New-Object IO.FileStream($zipfile, [IO.FileMode]::Open)
            $mode   = [IO.Compression.ZipArchiveMode]::Update
            $zip    = New-Object IO.Compression.ZipArchive($stream, $mode)
            ($zip.Entries | ? { $files -contains $_.Name }) | % { $_.Delete() }

            #Close zip
            $zip.Dispose()
            $stream.Close()
            $stream.Dispose()


        }

    }


    # Change the *.zip to *.pbix

    $stripped_models = Get-ChildItem -Path $dir -Filter *.zip
    $stripped_models | Rename-Item -newname { $_.name -replace '.zip','.pbix' }




    } 
else {
    "&gt;&gt;&gt;&gt;&gt;&gt;&gt; ERROR Path:  $dir doesn't exist   &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"
}</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Thanks to my colleague Bryan Campbell for his help.</p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="pawarbi/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/powerbi/analysisservices/as/powershell/2023/03/01/powerbi-analysisservices-stripping-connection.html" hidden></a>
</article>