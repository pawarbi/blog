<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Extracting Matching Words Using A Pre-Defined List in Power Query/M</h1><p class="page-description">Solution to extract words from a sentence in each row using a pre-defined list in Power Query</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-03-11T00:00:00-06:00" itemprop="datePublished">
        Mar 11, 2022
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      3 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#powerquery">powerquery</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#M">M</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#List">List</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/pawarbi/blog/tree/master/_notebooks/2022-03-11-powerquery-M-extracting-words.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/pawarbi/blog/master?filepath=_notebooks%2F2022-03-11-powerquery-M-extracting-words.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/pawarbi/blog/blob/master/_notebooks/2022-03-11-powerquery-M-extracting-words.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#Problem">Problem </a></li>
<li class="toc-entry toc-h2"><a href="#Solution">Solution </a>
<ul>
<li class="toc-entry toc-h4"><a href="#Step-1-:-Clean-and-Trim">Step 1 : Clean and Trim </a></li>
<li class="toc-entry toc-h4"><a href="#Step-2-:-Split-the-Text-using-Text.Split">Step 2 : Split the Text using Text.Split </a></li>
<li class="toc-entry toc-h4"><a href="#Step-2-:-Find-Matching-Words-Using-List.Intersect-with-List.Buffer">Step 2 : Find Matching Words Using List.Intersect with List.Buffer </a></li>
<li class="toc-entry toc-h4"><a href="#Step-3-:-Convert-List-to-Table-Using-Table.FromList">Step 3 : Convert List to Table Using Table.FromList </a></li>
<li class="toc-entry toc-h4"><a href="#Step-4-:-Expand-the-Table">Step 4 : Expand the Table </a></li>
<li class="toc-entry toc-h4"><a href="#Step-5-:-Remove-Intermediate-Columns">Step 5 : Remove Intermediate Columns </a></li>
<li class="toc-entry toc-h4"><a href="#Final-M-code:">Final M code: </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-03-11-powerquery-M-extracting-words.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Problem">
<a class="anchor" href="#Problem" aria-hidden="true"><span class="octicon octicon-link"></span></a>Problem<a class="anchor-link" href="#Problem"> </a>
</h2>
<p>A colleague reached out to me with an interesting problem. He wanted to extract certain error codes/phrases from sentences. He had a list of all possible codes and phrases and wanted it to be dynamic so that he can change the list of possible codes in the future. For example, imagine you survey 10 BI developers on which languages they use on a daily basis. Some might say Python, SQL, R, Excel etc. We have a list of all possible languages and we want to extract only the languages for that developer based on this list. If a language does not exist in the list, it should return a null value. See below what the final solution should look like:</p>
<p><img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/word13.png" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Solution">
<a class="anchor" href="#Solution" aria-hidden="true"><span class="octicon octicon-link"></span></a>Solution<a class="anchor-link" href="#Solution"> </a>
</h2>
<p>I couldn't find a solution online so I created one using List functions in M. All of the steps below can be wrapped into one nice function, but for demonstration purposes I will do it step by step. If you use this solution, just convert it into a function as needed. Also to keep the blog short, I am going to assume that the words/phrases match exactly with those in the list. You will need to format them (uppercase/lowercase/remove punctuations etc.) based on your scenario.</p>
<p>We start with 2 columns. First column contains unique id for each respondent and the second column has their text responses. We also have a list of languages as another query.</p>
<p><img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/word14.png" alt="">
<img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/lang%20list.png" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Step-1-:-Clean-and-Trim">
<a class="anchor" href="#Step-1-:-Clean-and-Trim" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 1 : Clean and Trim<a class="anchor-link" href="#Step-1-:-Clean-and-Trim"> </a>
</h4>
<p>Create a new column with the text trimmed and cleaned. You can go to Add column &gt; Format &gt; Trim &gt; Clean</p>
<p>If their are any punctuations, you should remove those as well in this step. We need each of the words to be isolated. For example, if the sentence contains "SQL," it will be treated as a one word. Remove the comma to turn "SQL," into "SQL".</p>
<p><img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/word15.png" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Step-2-:-Split-the-Text-using-Text.Split">
<a class="anchor" href="#Step-2-:-Split-the-Text-using-Text.Split" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 2 : Split the Text using <code>Text.Split</code><a class="anchor-link" href="#Step-2-:-Split-the-Text-using-Text.Split"> </a>
</h4>
<p>In this step we split the setence on each row into separate words and store them as a list using <code>Text.Split()</code> function.</p>
<p><img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/word16.png" alt=""></p>
<p>Notice after splitting we get a list on each row.</p>
<p><img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/word17.png" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Step-2-:-Find-Matching-Words-Using-List.Intersect-with-List.Buffer">
<a class="anchor" href="#Step-2-:-Find-Matching-Words-Using-List.Intersect-with-List.Buffer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 2 : Find Matching Words Using <code>List.Intersect</code> with <code>List.Buffer</code><a class="anchor-link" href="#Step-2-:-Find-Matching-Words-Using-List.Intersect-with-List.Buffer"> </a>
</h4>
<p>Now we need to lookup the pre-defined list to see if any of the words in the above list exist. The expected result is that if the list contains any of the pre-defined words, those should be returned otherwise we should get a null value. We can achieve this using <code>List.Intersect()</code>. I am wrapping the list with <code>List.Buffer()</code> to make lookup faster.</p>
<p><img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/word18.png" alt="">
Notice below, the Person1 uses Python so the resulting list on the first row contains only "Python" and no other words. 
<img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/wordlistshown.png" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Step-3-:-Convert-List-to-Table-Using-Table.FromList">
<a class="anchor" href="#Step-3-:-Convert-List-to-Table-Using-Table.FromList" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 3 : Convert List to Table Using <code>Table.FromList</code><a class="anchor-link" href="#Step-3-:-Convert-List-to-Table-Using-Table.FromList"> </a>
</h4>
<p>Convert the intersected list into a table using <code>Table.FromList</code>.</p>
<p><img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/word19.png" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Step-4-:-Expand-the-Table">
<a class="anchor" href="#Step-4-:-Expand-the-Table" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 4 : Expand the Table<a class="anchor-link" href="#Step-4-:-Expand-the-Table"> </a>
</h4>
<p>Now we just need to expand the table to get each matching word on a separate row for each person. You can eaither use <code>Table.ExpandTableColumn</code> or just click on the two double arrows</p>
<p><img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/word21.png" alt=""></p>
<p>After extracting :</p>
<p><img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/word11.png" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Step-5-:-Remove-Intermediate-Columns">
<a class="anchor" href="#Step-5-:-Remove-Intermediate-Columns" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 5 : Remove Intermediate Columns<a class="anchor-link" href="#Step-5-:-Remove-Intermediate-Columns"> </a>
</h4>
<p>Remove all the intermediate columns from steps 2-4 to keep only the resulting column with matching words! As I mentioned above, all these steps can be rolled into one nice function that can be used elsewhere as well.</p>
<p>Person2 had two languages Python &amp; R so we get two lines, whereas person5 &amp; 8 had no matching languages thus null.</p>
<p><img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/word12.png" alt=""></p>
<h4 id="Final-M-code:">
<a class="anchor" href="#Final-M-code:" aria-hidden="true"><span class="octicon octicon-link"></span></a>Final M code:<a class="anchor-link" href="#Final-M-code:"> </a>
</h4>
<p><img src="https://raw.githubusercontent.com/pawarbi/blog/master/images/finalMcarbon.png" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can download the .pbix from <a href="https://github.com/pawarbi/snippets/raw/main/extractword.pbix">here</a>. If you know a better, faster, more elegant solution, please let me know.</p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="pawarbi/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/powerquery/m/list/2022/03/11/powerquery-M-extracting-words.html" hidden></a>
</article>
